<svelte:head>
<title>bookish.tech</title>
</svelte:head>
<div class='mw6 ph4-ns sans-serif center'>
  <div class='flex justify-between items-end'>
    <h1 class='f3 mt4 mb0'>Booky</h1>
    <a href='/help'>help</a>
  </div>
  <Form />
  
  {#if preloading}
    <div>Loading...</div>
  {/if}

  <div class='pv3'>
    <div class='br2 pa2 bg-light-yellow flex justify-between'>
      <span>Input: {id}</span>
    </div>
    <h3 class='mt4'>Equivalents</h3>
    <table class='table w-100 collapse ba br2 b--black-10 pv2 ph3'>
      <tbody>
        <tr class='striped--moon-gray'>
          <th class='pv2 ph3 tl f6 fw6 ttu'>Code</th>
          <th class='pv2 ph3 tl f6 fw6 ttu'>Value</th>
        </tr>
	{#each Object.entries(ids) as [key, value]}
        <tr class='striped--moon-gray'>
          <td class='pv2 ph3'>{key}</td>
          <td class='pv2 ph3'>{value.join(", ")}</td>
        </tr>
	{/each}
      </tbody>
    </table>
    <h4 class='mt4'>Frontmatter</h4>
<pre>---
{Object.entries(ids).map(([key, value]) => `${key}: "${value[0]}"`).join("\n")}
---</pre>
  </div>
</div>

<script>
  export default {
    components: {
      Form: '../components/Form.html'
    },
    preload({ params, query }) {
      const { id, type } = query;
      return this.fetch(`https://api.bookish.tech/search?type=${type}&id=${id}`)
        .then(r => r.json()).then(ids => {
          return { ids, id };
        }, () => {
          return { error: 'Not found' };
        });
    }
  };
</script>
